---
title: "Using {utVizSankey}"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Using {utVizSankey}}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(utVizSankey)
```

## An example dataset

In the utVizSankey package, and example dataset "admissions" is available.

```{r}
data(admissions, package = "utVizSankey")

head(admissions)
```

The dataset contains `r ncol(admissions)` variables and `r nrow(admissions)` observations.

# A simple sankey chart

The function `sankey()` generates a sankey chart. The two main arguments to this function are:

- `data` (which provides the data-frame for the chart);
- and `steps` (indicating which columns of that data-frame should be presented in the chart, from
left-to-right).

```{r}
sankey(
  admissions,
  steps = c("student_type", "gpa", "outcome")
)
```

Steps can also be provided as a list containing vectors.
If a given step is a vector, then each element represents a drill-down stage for that column
in the Sankey diagram, starting from the first element. For example, a list of
`list(c("a", "b"), "c", "d")` will create a Sankey with three steps or columns which initially
shows data corresponding to the properties for the keys "a", "c", and "d" in the data.
Clicking on any node in the first column will drill-down to show the data for the "b" key,
filtered on a particular value for the "a" property.

```{r}
sankey(
  admissions,
  steps = list(c("student_type", "college"), "gpa", "outcome")
)
```

## Using {utVizSankey} in a shiny app

Example shiny apps that use `utVizSankey` are stored within the package. The source code can be
found in `./inst/shiny-examples/<app-name>`. To run these type
`run_shiny_example(app_name = "the-app")`.

Advanced: Data can be obtained from a node in a Sankey chart by alt-clicking on the node. A shiny
input-handler `utVizSankey.nodeConverter` is provided that will ensure the data is a data.frame when
it reaches R. To bind that data.frame to a shiny 'input' variable, you must provide an
`alt_click_handler` argument to the `sankey()` function. This should be a JavaScript function
created with `htmlwidgets::JS()` that takes the arguments "event" and "data".

```r
alt_click_handler = htmlwidgets::JS(r"(function(event, data){
  Shiny.setInputValue("a_shiny_input_var:utVizSankey.nodeConverter", data.entries)
})")

sankey(data, steps, alt_click_handler = alt_click_handler)
```

This binds the data associated with a Sankey node to the shiny variable `input$a_shiny_input_var`.
